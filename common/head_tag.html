<script>
// Ultra-early navigation hiding and text replacement - runs before Discourse's main JavaScript
(function() {
  'use strict';
  
  // ULTRA-AGGRESSIVE navigation hiding on /lists/ pages - inject CSS IMMEDIATELY
  if (window.location.pathname.includes('/lists/') || window.location.pathname.includes('/community/lists/')) {
    const navStyle = document.createElement('style');
    navStyle.id = 'ultra-early-nav-hiding';
    navStyle.textContent = `
      /* Ultra-aggressive hiding with multiple selector patterns */
      body[class*="/lists/"] #navigation-bar .nav-item_categories,
      body[class*="/lists/"] #navigation-bar .nav-item_latest, 
      body[class*="/lists/"] #navigation-bar .nav-item_new,
      body[class*="/lists/"] #navigation-bar .nav-item_top,
      body[class*="/lists/"] #navigation-bar .nav-item_unread,
      body[class*="lists-"] #navigation-bar .nav-item_categories,
      body[class*="lists-"] #navigation-bar .nav-item_latest, 
      body[class*="lists-"] #navigation-bar .nav-item_new,
      body[class*="lists-"] #navigation-bar .nav-item_top,
      body[class*="lists-"] #navigation-bar .nav-item_unread,
      body.lists-show #navigation-bar .nav-item_categories,
      body.lists-show #navigation-bar .nav-item_latest,
      body.lists-show #navigation-bar .nav-item_new,
      body.lists-show #navigation-bar .nav-item_top,
      body.lists-show #navigation-bar .nav-item_unread,
      body[data-page*="lists"] #navigation-bar .nav-item_categories,
      body[data-page*="lists"] #navigation-bar .nav-item_latest,
      body[data-page*="lists"] #navigation-bar .nav-item_new,
      body[data-page*="lists"] #navigation-bar .nav-item_top,
      body[data-page*="lists"] #navigation-bar .nav-item_unread {
        display: none !important;
        visibility: hidden !important;
        width: 0 !important;
        height: 0 !important;
        overflow: hidden !important;
        opacity: 0 !important;
      }
      
      /* Category and tag dropdowns */
      body[class*="/lists/"] .category-breadcrumb .category-drop,
      body[class*="/lists/"] .category-breadcrumb .tag-drop:not(.custom-list-dropdown),
      body[class*="lists-"] .category-breadcrumb .category-drop,
      body[class*="lists-"] .category-breadcrumb .tag-drop:not(.custom-list-dropdown),
      body.lists-show .category-breadcrumb .category-drop,
      body.lists-show .category-breadcrumb .tag-drop:not(.custom-list-dropdown),
      body[data-page*="lists"] .category-breadcrumb .category-drop,
      body[data-page*="lists"] .category-breadcrumb .tag-drop:not(.custom-list-dropdown) {
        display: none !important;
        visibility: hidden !important;
        width: 0 !important;
        height: 0 !important;
        overflow: hidden !important;
        opacity: 0 !important;
      }
      
      /* Parent li elements */
      body[class*="/lists/"] .category-breadcrumb li:first-child:not(:has(.custom-list-dropdown)),
      body[class*="/lists/"] .category-breadcrumb li:nth-child(2):not(:has(.custom-list-dropdown)),
      body[class*="lists-"] .category-breadcrumb li:first-child:not(:has(.custom-list-dropdown)),
      body[class*="lists-"] .category-breadcrumb li:nth-child(2):not(:has(.custom-list-dropdown)),
      body.lists-show .category-breadcrumb li:first-child:not(:has(.custom-list-dropdown)),
      body.lists-show .category-breadcrumb li:nth-child(2):not(:has(.custom-list-dropdown)),
      body[data-page*="lists"] .category-breadcrumb li:first-child:not(:has(.custom-list-dropdown)),
      body[data-page*="lists"] .category-breadcrumb li:nth-child(2):not(:has(.custom-list-dropdown)) {
        display: none !important;
        visibility: hidden !important;
        width: 0 !important;
        height: 0 !important;
        overflow: hidden !important;
        opacity: 0 !important;
      }
    `;
    
    // Insert at the very beginning of head for maximum priority
    if (document.head.firstChild) {
      document.head.insertBefore(navStyle, document.head.firstChild);
    } else {
      document.head.appendChild(navStyle);
    }
    
    // Also hide elements immediately with JavaScript
    const hideElementsImmediately = () => {
      const navItems = document.querySelectorAll('#navigation-bar .nav-item_categories, #navigation-bar .nav-item_latest, #navigation-bar .nav-item_new, #navigation-bar .nav-item_top, #navigation-bar .nav-item_unread');
      navItems.forEach(item => {
        item.style.display = 'none';
        item.style.visibility = 'hidden';
        item.style.opacity = '0';
        item.style.width = '0';
        item.style.height = '0';
        item.style.overflow = 'hidden';
      });
      
      const filterDropdowns = document.querySelectorAll('.category-breadcrumb .category-drop, .category-breadcrumb .tag-drop:not(.custom-list-dropdown)');
      filterDropdowns.forEach(item => {
        item.style.display = 'none';
        item.style.visibility = 'hidden';
        item.style.opacity = '0';
        item.style.width = '0';
        item.style.height = '0';
        item.style.overflow = 'hidden';
      });
      
      const breadcrumbItems = document.querySelectorAll('.category-breadcrumb li');
      breadcrumbItems.forEach((li, index) => {
        if (index < 2 && !li.querySelector('.custom-list-dropdown')) {
          li.style.display = 'none';
          li.style.visibility = 'hidden';
          li.style.opacity = '0';
          li.style.width = '0';
          li.style.height = '0';
          li.style.overflow = 'hidden';
        }
      });
    };
    
    // Run immediately
    hideElementsImmediately();
    
    // Run on every animation frame for the first second to catch any late-loading elements
    let frameCount = 0;
    const maxFrames = 60; // ~1 second at 60fps
    const frameHider = () => {
      hideElementsImmediately();
      frameCount++;
      if (frameCount < maxFrames) {
        requestAnimationFrame(frameHider);
      }
    };
    requestAnimationFrame(frameHider);
  }
  
  // Function to replace Custom lists with Solutions
  function replaceCustomListsText() {
    // Target the specific dropdown structure
    const customListHeaders = document.querySelectorAll('.tag-drop-header[data-name="Custom lists"], .select-kit-header[data-name="Custom lists"]');
    customListHeaders.forEach(header => {
      // Update attributes
      ['aria-label', 'name', 'data-name'].forEach(attr => {
        const value = header.getAttribute(attr);
        if (value && value.includes('Custom lists')) {
          header.setAttribute(attr, value.replace(/Custom lists/g, 'Solutions'));
        }
      });
      
      // Update child elements
      const nameElements = header.querySelectorAll('.name');
      nameElements.forEach(nameEl => {
        if (nameEl.textContent && nameEl.textContent.trim() === 'Custom lists') {
          nameEl.textContent = 'Solutions';
          nameEl.classList.add('solutions-ready'); // Mark as ready like banner approach
        } else if (nameEl.textContent && nameEl.textContent.trim()) {
          // If there's other text, mark as ready too
          nameEl.classList.add('solutions-ready');
        }
      });
      
      const selectedNames = header.querySelectorAll('.selected-name');
      selectedNames.forEach(selected => {
        ['title', 'data-name'].forEach(attr => {
          const value = selected.getAttribute(attr);
          if (value && value.includes('Custom lists')) {
            selected.setAttribute(attr, value.replace(/Custom lists/g, 'Solutions'));
          }
        });
      });
      
      // Mark the entire header as ready if it was processed
      if (customListHeaders.length > 0) {
        customListHeaders.forEach(header => {
          const dropdown = header.closest('.custom-list-dropdown');
          if (dropdown) {
            dropdown.classList.add('solutions-ready');
          }
        });
      }
    });
    
    // Also target by class in case data-name isn't set yet
    const customListDropdowns = document.querySelectorAll('.custom-list-dropdown');
    customListDropdowns.forEach(dropdown => {
      let wasProcessed = false;
      const nameElements = dropdown.querySelectorAll('.name');
      nameElements.forEach(nameEl => {
        if (nameEl.textContent && nameEl.textContent.trim() === 'Custom lists') {
          nameEl.textContent = 'Solutions';
          nameEl.classList.add('solutions-ready');
          wasProcessed = true;
        } else if (nameEl.textContent && nameEl.textContent.trim()) {
          // If there's other text, mark as ready
          nameEl.classList.add('solutions-ready');
          wasProcessed = true;
        }
      });
      
      if (wasProcessed) {
        dropdown.classList.add('solutions-ready');
      }
    });
  }
  
  // Run immediately if DOM is already loaded
  if (document.readyState !== 'loading') {
    replaceCustomListsText();
  }
  
  // Run when DOM content is loaded
  document.addEventListener('DOMContentLoaded', replaceCustomListsText);
  
  // Use MutationObserver to catch dynamically added content
  const observer = new MutationObserver(function(mutations) {
    let shouldReplace = false;
    
    mutations.forEach(function(mutation) {
      if (mutation.type === 'childList') {
        const addedNodes = Array.from(mutation.addedNodes);
        addedNodes.forEach(function(node) {
          if (node.nodeType === 1) { // Element node
            // Check if it's a custom list dropdown or contains one
            if (node.classList && (
                node.classList.contains('custom-list-dropdown') ||
                node.classList.contains('tag-drop-header') ||
                node.classList.contains('select-kit-header')
              )) {
              shouldReplace = true;
            } else if (node.querySelector) {
              if (node.querySelector('.custom-list-dropdown') ||
                  node.querySelector('.tag-drop-header') ||
                  node.querySelector('[data-name="Custom lists"]')) {
                shouldReplace = true;
              }
            }
          }
        });
      } else if (mutation.type === 'characterData') {
        // Text content changed
        if (mutation.target.textContent && mutation.target.textContent.includes('Custom lists')) {
          shouldReplace = true;
        }
      } else if (mutation.type === 'attributes') {
        // Attribute changed
        if (mutation.attributeName === 'data-name' || mutation.attributeName === 'aria-label') {
          const value = mutation.target.getAttribute(mutation.attributeName);
          if (value && value.includes('Custom lists')) {
            shouldReplace = true;
          }
        }
      }
    });
    
    if (shouldReplace) {
      // Small delay to ensure DOM is stable
      setTimeout(replaceCustomListsText, 1);
    }
  });
  
  // Start observing immediately
  if (document.documentElement) {
    observer.observe(document.documentElement, {
      childList: true,
      subtree: true,
      characterData: true,
      attributes: true,
      attributeFilter: ['data-name', 'aria-label', 'name', 'title']
    });
  }
  
  // Fallback: run periodically for the first few seconds
  let attempts = 0;
  const maxAttempts = 20; // Run for 10 seconds (20 * 500ms)
  
  const periodicReplace = function() {
    attempts++;
    replaceCustomListsText();
    
    if (attempts < maxAttempts) {
      setTimeout(periodicReplace, 500);
    }
  };
  
  // Start periodic replacement after a short delay
  setTimeout(periodicReplace, 100);
  
  // Ultimate fallback: ensure all dropdown text is visible after 3 seconds
  setTimeout(function() {
    const allCustomDropdowns = document.querySelectorAll('.custom-list-dropdown');
    allCustomDropdowns.forEach(function(dropdown) {
      dropdown.classList.add('solutions-ready');
      const allNames = dropdown.querySelectorAll('.name');
      allNames.forEach(function(name) {
        name.classList.add('solutions-ready');
      });
    });
  }, 3000);
})();
</script>