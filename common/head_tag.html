<script>
// Ultra-early navigation hiding and text replacement - runs before Discourse's main JavaScript
(function() {
  'use strict';
  
  // ULTRA-AGGRESSIVE navigation hiding on /lists/ pages - inject CSS IMMEDIATELY
  if (window.location.pathname.includes('/lists/') || window.location.pathname.includes('/community/lists/')) {
    const navStyle = document.createElement('style');
    navStyle.id = 'ultra-early-nav-hiding';
    navStyle.textContent = `
      /* Ultra-aggressive hiding with multiple selector patterns - MAIN NAVIGATION */
      body[class*="/lists/"] #navigation-bar .nav-item_categories,
      body[class*="/lists/"] #navigation-bar .nav-item_latest, 
      body[class*="/lists/"] #navigation-bar .nav-item_new,
      body[class*="/lists/"] #navigation-bar .nav-item_top,
      body[class*="/lists/"] #navigation-bar .nav-item_unread,
      body[class*="lists-"] #navigation-bar .nav-item_categories,
      body[class*="lists-"] #navigation-bar .nav-item_latest, 
      body[class*="lists-"] #navigation-bar .nav-item_new,
      body[class*="lists-"] #navigation-bar .nav-item_top,
      body[class*="lists-"] #navigation-bar .nav-item_unread,
      body.lists-show #navigation-bar .nav-item_categories,
      body.lists-show #navigation-bar .nav-item_latest,
      body.lists-show #navigation-bar .nav-item_new,
      body.lists-show #navigation-bar .nav-item_top,
      body.lists-show #navigation-bar .nav-item_unread,
      body[data-page*="lists"] #navigation-bar .nav-item_categories,
      body[data-page*="lists"] #navigation-bar .nav-item_latest,
      body[data-page*="lists"] #navigation-bar .nav-item_new,
      body[data-page*="lists"] #navigation-bar .nav-item_top,
      body[data-page*="lists"] #navigation-bar .nav-item_unread,
      /* Ultra-aggressive hiding - SORTING NAVIGATION */
      body[class*="/lists/"] .navigation-controls .nav-pills .nav-item,
      body[class*="/lists/"] .topic-list-header .sortable,
      body[class*="/lists/"] .period-chooser,
      body[class*="/lists/"] .list-controls .nav-pills,
      body[class*="lists-"] .navigation-controls .nav-pills .nav-item,
      body[class*="lists-"] .topic-list-header .sortable,
      body[class*="lists-"] .period-chooser,
      body[class*="lists-"] .list-controls .nav-pills,
      body.lists-show .navigation-controls .nav-pills .nav-item,
      body.lists-show .topic-list-header .sortable,
      body.lists-show .period-chooser,
      body.lists-show .list-controls .nav-pills,
      body[data-page*="lists"] .navigation-controls .nav-pills .nav-item,
      body[data-page*="lists"] .topic-list-header .sortable,
      body[data-page*="lists"] .period-chooser,
      body[data-page*="lists"] .list-controls .nav-pills {
        display: none !important;
        visibility: hidden !important;
        width: 0 !important;
        height: 0 !important;
        overflow: hidden !important;
        opacity: 0 !important;
      }
      
      /* Category and tag dropdowns */
      body[class*="/lists/"] .category-breadcrumb .category-drop,
      body[class*="/lists/"] .category-breadcrumb .tag-drop:not(.custom-list-dropdown),
      body[class*="lists-"] .category-breadcrumb .category-drop,
      body[class*="lists-"] .category-breadcrumb .tag-drop:not(.custom-list-dropdown),
      body.lists-show .category-breadcrumb .category-drop,
      body.lists-show .category-breadcrumb .tag-drop:not(.custom-list-dropdown),
      body[data-page*="lists"] .category-breadcrumb .category-drop,
      body[data-page*="lists"] .category-breadcrumb .tag-drop:not(.custom-list-dropdown) {
        display: none !important;
        visibility: hidden !important;
        width: 0 !important;
        height: 0 !important;
        overflow: hidden !important;
        opacity: 0 !important;
      }
      
      /* Parent li elements */
      body[class*="/lists/"] .category-breadcrumb li:first-child:not(:has(.custom-list-dropdown)),
      body[class*="/lists/"] .category-breadcrumb li:nth-child(2):not(:has(.custom-list-dropdown)),
      body[class*="lists-"] .category-breadcrumb li:first-child:not(:has(.custom-list-dropdown)),
      body[class*="lists-"] .category-breadcrumb li:nth-child(2):not(:has(.custom-list-dropdown)),
      body.lists-show .category-breadcrumb li:first-child:not(:has(.custom-list-dropdown)),
      body.lists-show .category-breadcrumb li:nth-child(2):not(:has(.custom-list-dropdown)),
      body[data-page*="lists"] .category-breadcrumb li:first-child:not(:has(.custom-list-dropdown)),
      body[data-page*="lists"] .category-breadcrumb li:nth-child(2):not(:has(.custom-list-dropdown)) {
        display: none !important;
        visibility: hidden !important;
        width: 0 !important;
        height: 0 !important;
        overflow: hidden !important;
        opacity: 0 !important;
      }
    `;
    
    // Insert at the very beginning of head for maximum priority
    if (document.head.firstChild) {
      document.head.insertBefore(navStyle, document.head.firstChild);
    } else {
      document.head.appendChild(navStyle);
    }
    
    // Also hide elements immediately with JavaScript
    const hideElementsImmediately = () => {
      // Main navigation items
      const navItems = document.querySelectorAll('#navigation-bar .nav-item_categories, #navigation-bar .nav-item_latest, #navigation-bar .nav-item_new, #navigation-bar .nav-item_top, #navigation-bar .nav-item_unread');
      navItems.forEach(item => {
        item.style.display = 'none';
        item.style.visibility = 'hidden';
        item.style.opacity = '0';
        item.style.width = '0';
        item.style.height = '0';
        item.style.overflow = 'hidden';
      });
      
      // Sorting navigation elements
      const sortingElements = document.querySelectorAll('.navigation-controls .nav-pills .nav-item, .topic-list-header .sortable, .period-chooser, .list-controls .nav-pills');
      sortingElements.forEach(item => {
        item.style.display = 'none';
        item.style.visibility = 'hidden';
        item.style.opacity = '0';
        item.style.width = '0';
        item.style.height = '0';
        item.style.overflow = 'hidden';
      });
      
      const filterDropdowns = document.querySelectorAll('.category-breadcrumb .category-drop, .category-breadcrumb .tag-drop:not(.custom-list-dropdown)');
      filterDropdowns.forEach(item => {
        item.style.display = 'none';
        item.style.visibility = 'hidden';
        item.style.opacity = '0';
        item.style.width = '0';
        item.style.height = '0';
        item.style.overflow = 'hidden';
      });
      
      const breadcrumbItems = document.querySelectorAll('.category-breadcrumb li');
      breadcrumbItems.forEach((li, index) => {
        if (index < 2 && !li.querySelector('.custom-list-dropdown')) {
          li.style.display = 'none';
          li.style.visibility = 'hidden';
          li.style.opacity = '0';
          li.style.width = '0';
          li.style.height = '0';
          li.style.overflow = 'hidden';
        }
      });
    };
    
    // Run immediately
    hideElementsImmediately();
    
    // Run on every animation frame for the first second to catch any late-loading elements
    let frameCount = 0;
    const maxFrames = 60; // ~1 second at 60fps
    const frameHider = () => {
      hideElementsImmediately();
      frameCount++;
      if (frameCount < maxFrames) {
        requestAnimationFrame(frameHider);
      }
    };
    requestAnimationFrame(frameHider);
  }
  
  // ULTRA-AGGRESSIVE function to replace Custom lists with Solutions
  function ultraAggressiveTextReplacement() {
    // Hide dropdown text until replacement is complete - IMMEDIATE CSS injection
    if (!document.getElementById('ultra-text-replacement-css')) {
      const textStyle = document.createElement('style');
      textStyle.id = 'ultra-text-replacement-css';
      textStyle.textContent = `
        .custom-list-dropdown .select-kit-selected-name .name,
        .custom-list-dropdown .selected-name .name,
        .custom-list-dropdown .name,
        .tag-drop-header[data-name*="Custom"] .name,
        .select-kit-header[data-name*="Custom"] .name {
          visibility: hidden !important;
          opacity: 0 !important;
        }
        
        .custom-list-dropdown.solutions-ready .select-kit-selected-name .name,
        .custom-list-dropdown.solutions-ready .selected-name .name,
        .custom-list-dropdown.solutions-ready .name,
        .tag-drop-header[data-name*="Solutions"] .name,
        .select-kit-header[data-name*="Solutions"] .name,
        .solutions-ready .name {
          visibility: visible !important;
          opacity: 1 !important;
        }
      `;
      document.head.appendChild(textStyle);
    }
    
    // Ultra-aggressive text replacement with multiple approaches
    const selectors = [
      '.tag-drop-header[data-name="Custom lists"]',
      '.select-kit-header[data-name="Custom lists"]',
      '.custom-list-dropdown .select-kit-header',
      '.custom-list-dropdown',
      '[data-name*="Custom lists"]',
      '[aria-label*="Custom lists"]'
    ];
    
    selectors.forEach(selector => {
      const elements = document.querySelectorAll(selector);
      elements.forEach(element => {
        // Update all possible attributes
        ['aria-label', 'name', 'data-name', 'title'].forEach(attr => {
          const value = element.getAttribute(attr);
          if (value && value.includes('Custom lists')) {
            element.setAttribute(attr, value.replace(/Custom lists/g, 'Solutions'));
          }
        });
        
        // Update ONLY header text content, avoid dropdown body
        const nameElements = element.querySelectorAll('.name, .selected-name, .select-kit-selected-name');
        nameElements.forEach(nameEl => {
          // Skip if this element is inside a dropdown body
          if (nameEl.closest('.select-kit-body')) return;
          
          if (nameEl.textContent && nameEl.textContent.includes('Custom lists')) {
            nameEl.textContent = nameEl.textContent.replace(/Custom lists/g, 'Solutions');
            nameEl.classList.add('solutions-ready');
          }
        });
        
        // Direct text content replacement ONLY for headers
        if (element.classList.contains('select-kit-header') && 
            element.textContent && element.textContent.includes('Custom lists')) {
          element.textContent = element.textContent.replace(/Custom lists/g, 'Solutions');
        }
        
        // Mark as processed
        const dropdown = element.closest('.custom-list-dropdown') || element;
        if (dropdown.classList && dropdown.classList.contains('custom-list-dropdown')) {
          dropdown.classList.add('solutions-ready');
        }
      });
    });
    
    // Ultra-aggressive direct text node replacement
    const walker = document.createTreeWalker(
      document.body || document.documentElement,
      NodeFilter.SHOW_TEXT,
      {
        acceptNode: function(node) {
          if (node.textContent && node.textContent.includes('Custom lists')) {
            const parent = node.parentElement;
            // EXCLUDE dropdown body content and options to prevent clearing
            if (parent && parent.closest('.select-kit-body')) {
              return NodeFilter.FILTER_REJECT;
            }
            if (parent && parent.closest('.select-kit-collection')) {
              return NodeFilter.FILTER_REJECT;
            }
            if (parent && parent.closest('.select-kit-row')) {
              return NodeFilter.FILTER_REJECT;
            }
            
            // INCLUDE only header/label elements for replacement
            if (parent && (
              parent.closest('.select-kit-header') ||
              parent.classList.contains('name') ||
              parent.classList.contains('selected-name') ||
              parent.classList.contains('select-kit-selected-name')
            )) {
              return NodeFilter.FILTER_ACCEPT;
            }
          }
          return NodeFilter.FILTER_REJECT;
        }
      }
    );
    
    let textNode;
    while (textNode = walker.nextNode()) {
      textNode.textContent = textNode.textContent.replace(/Custom lists/g, 'Solutions');
      const parent = textNode.parentElement;
      if (parent) {
        parent.classList.add('solutions-ready');
        const dropdown = parent.closest('.custom-list-dropdown');
        if (dropdown) {
          dropdown.classList.add('solutions-ready');
        }
      }
    }
  }
  
  // Run immediately if DOM is already loaded
  if (document.readyState !== 'loading') {
    ultraAggressiveTextReplacement();
  }
  
  // Run when DOM content is loaded
  document.addEventListener('DOMContentLoaded', ultraAggressiveTextReplacement);
  
  // ULTRA-AGGRESSIVE: Run on every animation frame for first second
  let frameCount = 0;
  const maxFrames = 60; // ~1 second at 60fps
  const frameTextReplacer = () => {
    ultraAggressiveTextReplacement();
    frameCount++;
    if (frameCount < maxFrames) {
      requestAnimationFrame(frameTextReplacer);
    }
  };
  requestAnimationFrame(frameTextReplacer);
  
  // Use MutationObserver to catch dynamically added content
  const observer = new MutationObserver(function(mutations) {
    let shouldReplace = false;
    
    mutations.forEach(function(mutation) {
      if (mutation.type === 'childList') {
        const addedNodes = Array.from(mutation.addedNodes);
        addedNodes.forEach(function(node) {
          if (node.nodeType === 1) { // Element node
            // Check if it's a custom list dropdown or contains one
            if (node.classList && (
                node.classList.contains('custom-list-dropdown') ||
                node.classList.contains('tag-drop-header') ||
                node.classList.contains('select-kit-header')
              )) {
              shouldReplace = true;
            } else if (node.querySelector) {
              if (node.querySelector('.custom-list-dropdown') ||
                  node.querySelector('.tag-drop-header') ||
                  node.querySelector('[data-name*="Custom"]')) {
                shouldReplace = true;
              }
            }
          }
        });
      } else if (mutation.type === 'characterData') {
        // Text content changed
        if (mutation.target.textContent && mutation.target.textContent.includes('Custom lists')) {
          shouldReplace = true;
        }
      } else if (mutation.type === 'attributes') {
        // Attribute changed
        if (mutation.attributeName === 'data-name' || mutation.attributeName === 'aria-label') {
          const value = mutation.target.getAttribute(mutation.attributeName);
          if (value && value.includes('Custom lists')) {
            shouldReplace = true;
          }
        }
      }
    });
    
    if (shouldReplace) {
      // Immediate replacement, no delay
      ultraAggressiveTextReplacement();
    }
  });
  
  // Start observing immediately
  if (document.documentElement) {
    observer.observe(document.documentElement, {
      childList: true,
      subtree: true,
      characterData: true,
      attributes: true,
      attributeFilter: ['data-name', 'aria-label', 'name', 'title']
    });
  }
  
  // ULTRA-AGGRESSIVE: Run every 50ms for the first 5 seconds
  let intervalCount = 0;
  const maxIntervals = 100; // 5 seconds (100 * 50ms)
  const persistentTextReplacer = setInterval(() => {
    ultraAggressiveTextReplacement();
    intervalCount++;
    if (intervalCount >= maxIntervals) {
      clearInterval(persistentTextReplacer);
    }
  }, 50);
  
  // Ultimate fallback: ensure all dropdown text is visible after 3 seconds
  setTimeout(function() {
    const allCustomDropdowns = document.querySelectorAll('.custom-list-dropdown');
    allCustomDropdowns.forEach(function(dropdown) {
      dropdown.classList.add('solutions-ready');
      const allNames = dropdown.querySelectorAll('.name');
      allNames.forEach(function(name) {
        name.classList.add('solutions-ready');
      });
    });
  }, 3000);
})();
</script>